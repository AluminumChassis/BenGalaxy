<!--COPYRIGHT 2018 BENJAMIN CICCARELLI-->
<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" >
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="icon" href="earth.png" type="image/png"/>
	<link href="https://fonts.googleapis.com/css?family=Niramit" rel="stylesheet">
	<script src="main.js"></script>
	<title>Ben Galaxy</title>
</head>
<body bgcolor="#000" id="body" onresize="detectOrientation()"onload="loadPage()">
<canvas width="1080" height="720" id="bgcanvas">
</canvas>
<container id="main">
	<a href="home.html"><image class="headImage" src="BenGalaxy.png"></image></a>
	<textarea placeholder="Type here..." id="typingBox" oninput="onType()" class="typingBox" type="text"></textarea>
  	<p id="registerArea" class="registers" style="font-size: 15px;"><sub></sub></p>
	<button onclick="runLine()" class="runButton">Run Line</button>

</container>
<div class="bottomLinks" style="bottom: 80px"><a href="mailto:ben@bengalaxy.com">Contact</a></div>
<div class="bottomLinks" style="bottom: 60px">Copyright Â© 2018 Benjamin Ciccarelli</div>
</body>
<script type="text/javascript">
function loadPage() {
	pageOnLoad();
	updateHtml();
}
/*

add r0,1
cmp r0,0
bgt bigger
blt smaller
beq same

bigger:
sub r0,1
mov pc,0

smaller:
add r0,1
mov pc,0

same:
move pc,0

*/
var lines;
var registers = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
function onType() {
	lines = document.getElementById("typingBox").value.toLowerCase().split("\n");
}
function updateHtml(){
	document.getElementById("registerArea").innerHTML = "";
	for (var i = 0; i < registers.length-2; i++) {
		document.getElementById("registerArea").innerHTML += "Register r"+(i)+": ["+registers[i]+"], <br>"; 
	}
	document.getElementById("registerArea").innerHTML += "Link Register lr: ["+(registers[13]+1)+"], <br>"; 
	document.getElementById("registerArea").innerHTML += "Program Counter pc: ["+(registers[14]+1)+"], <br>"; 
}
function runLine() {
	
	if(lines.length > registers[14]){
		_tempRegister = registers[14];
		currentLine = lines[registers[14]];
		if(currentLine.toLowerCase().startsWith("add ")){
			_register = identifyRegister(currentLine.substring(7,9))
			if(typeof _register != "string") {
				registers[identifyRegister(currentLine.substring(4,6))] += registers[_register];
			} else {
				registers[identifyRegister(currentLine.substring(4,6))] += parseInt(currentLine.substring(7));
			}

		}else if(currentLine.toLowerCase().startsWith("sub ")){
			_register = identifyRegister(currentLine.substring(7,9))
			if(typeof _register != "string") {
				registers[identifyRegister(currentLine.substring(4,6))] -= registers[_register];
			} else {
				registers[identifyRegister(currentLine.substring(4,6))] -= parseInt(currentLine.substring(7));
			}
		}else if(currentLine.toLowerCase().startsWith("mov ")){
			_register = identifyRegister(currentLine.substring(7,9))
			if(typeof _register != "string") {
				registers[identifyRegister(currentLine.substring(4,6))] = registers[_register];
			} else {
				registers[identifyRegister(currentLine.substring(4,6))] = parseInt(currentLine.substring(7));
			}
		}else if(currentLine.toLowerCase().startsWith("cmp ")){
			_register = identifyRegister(currentLine.substring(7,9))
			if(typeof _register != "string") {
				if(registers[identifyRegister(currentLine.substring(4,6))] == registers[_register]) {
					movePcTo("eq");
				} 
				if(registers[identifyRegister(currentLine.substring(4,6))] > registers[_register]) {
					movePcTo("gt");
				}
				if(registers[identifyRegister(currentLine.substring(4,6))] < registers[_register]) {
					movePcTo("lt");
				}
			} else {
				if(registers[identifyRegister(currentLine.substring(4,6))] == parseInt(currentLine.substring(7))) {
						movePcTo("eq");
				}
				if(registers[identifyRegister(currentLine.substring(4,6))] > parseInt(currentLine.substring(7))) {
						movePcTo("gt");
				}
				if(registers[identifyRegister(currentLine.substring(4,6))] < parseInt(currentLine.substring(7))) {
					movePcTo("lt");
				}
			}
		} else if(currentLine.toLowerCase().startsWith("b ")) {
			for(var g = 0; g < lines.length; g++) {
				if(lines[g].startsWith(currentLine.substring(2) + ":")) {
					console.log(g);
					registers[14] = g;
				}
			}
		} else if(currentLine.toLowerCase().startsWith("bl ")) {
			console.log("link");
			for(var g = 0; g < lines.length; g++) {
				if(lines[g].startsWith(currentLine.substring(3) + ":")) {
					console.log(g);
					registers[13]=registers[14]+1;
					registers[14]=g+1;
				}
			}
		}

		if(_tempRegister == registers[14]) {
			registers[14]++;
		}
		if(lines.length == registers[14]){
			registers[14]=0;
		}

	
	} else {
		registers[14]=0;
	}
	updateHtml();
}
function movePcTo(operation, start) {
	k=1
	operation = operation.toLowerCase();
	while((typeof lines[registers[14]+k] != "undefined") &&(!lines[registers[14]+k].substring(0,5).includes(operation))) {
		
		k++
		if(lines[registers[14]+k]=="" || k==lines.length) {
			break;
		}
	}
	if((typeof lines[registers[14]+k] != "undefined") && lines[registers[14]+k].substring(0,5).includes(operation)) {
		lines[registers[14]+k]=lines[registers[14]+k].replace(operation,"");
		console.log(lines[registers[14]+k]);
	}
}
function identifyRegister(re) {
	if(re.startsWith("r")) {
		return(parseInt(re.substring(1)));
	}
	switch (re) {
			case "lr":
				return 13
			case "pc":
				return 14
		}
	return "nein"
}
</script>
</html>
